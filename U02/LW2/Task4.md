# Task 4

```sql

select TSS.NAME, 
trunc(tsuf.START_DTM, 'YYYY')      AS YEAR,
trunc(tsuf.START_DTM, 'MM')      AS MONTH,
SUM(tsuf.PAYMENT) AS PROFIT_BY_MOUNTH,
DECODE(grouping(trunc(tsuf.START_DTM, 'MM')), 1, 'OTHER', 'MONTH') TYPE ,
decode(grouping_id( trunc(tsuf.START_DTM, 'YYYY'), trunc(tsuf.START_DTM, 'MM'), TSS.NAME),
        7, 'All',
        3, 'SUBSCRIPTION',
        1, 'SUBSCRIPTION-YEAR', 
        'SUBSCRIPTION-YEAR-MONTH') DICT
from U_DW_SUBSTRICTIONS.T_SUBSCRIPTIONS_USER_F tsuf 
inner join 
(SELECT *
FROM
U_DW_SUBSTRICTIONS.T_SUBSCRIPTIONS TS
INNER JOIN 
U_DW_SUBSTRICTIONS.T_SUBSCRIPTIONS_NAME TSN
ON 
TS.ID_SUBSCRIPTIONS_NAME=TSN.ID_SUBSCRIPTIONS_NAME)
TSS 
on 
tsuf.ID_SUBSCRIPTIONS=TSS.ID_SUBSCRIPTIONS
GROUP BY ROLLUP  (
    TSS.NAME, 
    trunc(tsuf.START_DTM, 'YYYY'),
    trunc(tsuf.START_DTM, 'MM') );

--NAME   |YEAR                   |MONTH                  |PROFIT_BY_MOUNTH|DECODE(GROUPING(TRUNC(TSUF.START_DTM,'MM')),1,'OTHER','MONTH')|DECODE(GROUPING_ID(TRUNC(TSUF.START_DTM,'YYYY'),TRUNC(TSUF.START_DTM,'MM'),TSS.NAME),7,'ALL',3,'SUBSCRIPTION',1,'SUBSCRIPTION-YEAR','SUBSCRIPTION-YEAR-MONTH')|
---------+-----------------------+-----------------------+----------------+--------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------+
--START  |2021-01-01 00:00:00.000|2021-09-01 00:00:00.000|       119443.56|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--PREMIUM|2021-01-01 00:00:00.000|2021-09-01 00:00:00.000|           22316|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--YEAR   |2021-01-01 00:00:00.000|2021-07-01 00:00:00.000|        54935.11|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--START  |2022-01-01 00:00:00.000|2022-07-01 00:00:00.000|         7414.92|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--PREMIUM|2022-01-01 00:00:00.000|2022-07-01 00:00:00.000|        84010.79|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--MEDIUM |2022-01-01 00:00:00.000|2022-07-01 00:00:00.000|        42478.08|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--PREMIUM|2021-01-01 00:00:00.000|2021-07-01 00:00:00.000|        18722.56|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--PREMIUM|2021-01-01 00:00:00.000|2021-10-01 00:00:00.000|        26223.18|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--YEAR   |2021-01-01 00:00:00.000|2021-09-01 00:00:00.000|       258737.17|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--START  |2021-01-01 00:00:00.000|2021-02-01 00:00:00.000|        14230.57|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--MEDIUM |2021-01-01 00:00:00.000|2021-10-01 00:00:00.000|        40056.53|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--START  |2021-01-01 00:00:00.000|2021-10-01 00:00:00.000|         7123.82|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--PREMIUM|2022-01-01 00:00:00.000|2022-03-01 00:00:00.000|         80368.4|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--MEDIUM |2021-01-01 00:00:00.000|2021-02-01 00:00:00.000|         9638.84|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--YEAR   |2021-01-01 00:00:00.000|2021-08-01 00:00:00.000|        270026.2|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--MEDIUM |2021-01-01 00:00:00.000|2021-08-01 00:00:00.000|        44028.15|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--YEAR   |2021-01-01 00:00:00.000|2021-02-01 00:00:00.000|        50144.72|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--PREMIUM|2021-01-01 00:00:00.000|2021-02-01 00:00:00.000|        16344.54|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--PREMIUM|2021-01-01 00:00:00.000|2021-08-01 00:00:00.000|        23622.88|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--PREMIUM|2021-01-01 00:00:00.000|2021-11-01 00:00:00.000|        26753.44|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--START  |2021-01-01 00:00:00.000|2021-08-01 00:00:00.000|       123756.73|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--MEDIUM |2021-01-01 00:00:00.000|2021-03-01 00:00:00.000|        10870.22|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--START  |2021-01-01 00:00:00.000|2021-03-01 00:00:00.000|        15222.89|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--YEAR   |2021-01-01 00:00:00.000|2021-03-01 00:00:00.000|        56049.72|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--MEDIUM |2021-01-01 00:00:00.000|2021-09-01 00:00:00.000|        43302.88|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--MEDIUM |2021-01-01 00:00:00.000|2021-11-01 00:00:00.000|        41907.87|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--PREMIUM|2021-01-01 00:00:00.000|2021-03-01 00:00:00.000|        17924.04|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--PREMIUM|2021-01-01 00:00:00.000|2021-04-01 00:00:00.000|           17320|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--START  |2021-01-01 00:00:00.000|2021-04-01 00:00:00.000|        14889.73|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--PREMIUM|2022-01-01 00:00:00.000|2022-04-01 00:00:00.000|        80750.82|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--START  |2021-01-01 00:00:00.000|2021-12-01 00:00:00.000|         7321.34|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--MEDIUM |2021-01-01 00:00:00.000|2021-12-01 00:00:00.000|         41491.3|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--MEDIUM |2021-01-01 00:00:00.000|2021-04-01 00:00:00.000|        10534.86|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--PREMIUM|2022-01-01 00:00:00.000|2022-05-01 00:00:00.000|        84404.56|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--YEAR   |2021-01-01 00:00:00.000|2021-04-01 00:00:00.000|        53807.41|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--MEDIUM |2021-01-01 00:00:00.000|2021-05-01 00:00:00.000|        10870.58|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--START  |2021-01-01 00:00:00.000|2021-05-01 00:00:00.000|        15270.85|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--PREMIUM|2022-01-01 00:00:00.000|2022-01-01 00:00:00.000|        27260.05|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--MEDIUM |2022-01-01 00:00:00.000|2022-01-01 00:00:00.000|        40506.13|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--PREMIUM|2021-01-01 00:00:00.000|2021-05-01 00:00:00.000|        18245.19|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--YEAR   |2021-01-01 00:00:00.000|2021-05-01 00:00:00.000|        54908.59|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--START  |2022-01-01 00:00:00.000|2022-01-01 00:00:00.000|         7432.29|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--PREMIUM|2022-01-01 00:00:00.000|2022-06-01 00:00:00.000|        80842.49|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--MEDIUM |2021-01-01 00:00:00.000|2021-06-01 00:00:00.000|        10566.46|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--START  |2021-01-01 00:00:00.000|2021-06-01 00:00:00.000|        14575.55|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--PREMIUM|2021-01-01 00:00:00.000|2021-06-01 00:00:00.000|        17574.45|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--MEDIUM |2022-01-01 00:00:00.000|2022-02-01 00:00:00.000|        37365.05|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--START  |2022-01-01 00:00:00.000|2022-02-01 00:00:00.000|         6632.83|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--YEAR   |2021-01-01 00:00:00.000|2021-06-01 00:00:00.000|        53086.57|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--PREMIUM|2022-01-01 00:00:00.000|2022-02-01 00:00:00.000|        24748.56|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--START  |2022-01-01 00:00:00.000|2022-03-01 00:00:00.000|         7243.57|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--MEDIUM |2022-01-01 00:00:00.000|2022-03-01 00:00:00.000|        42350.61|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--MEDIUM |2021-01-01 00:00:00.000|2021-07-01 00:00:00.000|        10408.32|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--MEDIUM |2022-01-01 00:00:00.000|2022-04-01 00:00:00.000|        39970.61|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--START  |2022-01-01 00:00:00.000|2022-04-01 00:00:00.000|         7186.25|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--PREMIUM|2021-01-01 00:00:00.000|2021-12-01 00:00:00.000|        27983.93|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--MEDIUM |2022-01-01 00:00:00.000|2022-05-01 00:00:00.000|        40422.82|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--START  |2022-01-01 00:00:00.000|2022-06-01 00:00:00.000|         7224.66|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--MEDIUM |2022-01-01 00:00:00.000|2022-06-01 00:00:00.000|        41553.66|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--START  |2021-01-01 00:00:00.000|2021-11-01 00:00:00.000|          7057.5|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--START  |2021-01-01 00:00:00.000|2021-07-01 00:00:00.000|        14939.44|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--START  |2022-01-01 00:00:00.000|2022-05-01 00:00:00.000|         7281.69|MONTH                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--START  |2021-01-01 00:00:00.000|                       |       353831.98|OTHER                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--PREMIUM|2021-01-01 00:00:00.000|                       |       233030.21|OTHER                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--YEAR   |2021-01-01 00:00:00.000|                       |       851695.49|OTHER                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--START  |2022-01-01 00:00:00.000|                       |        50416.21|OTHER                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--PREMIUM|2022-01-01 00:00:00.000|                       |       462385.67|OTHER                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--MEDIUM |2022-01-01 00:00:00.000|                       |       284646.96|OTHER                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--MEDIUM |2021-01-01 00:00:00.000|                       |       273676.01|OTHER                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--START  |                       |                       |       404248.19|OTHER                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--PREMIUM|                       |                       |       695415.88|OTHER                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--YEAR   |                       |                       |       851695.49|OTHER                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--MEDIUM |                       |                       |       558322.97|OTHER                                                         |SUBSCRIPTION-YEAR-MONTH                                                                                                                                       |
--       |                       |                       |      2509682.53|OTHER                                                         |All                                                                                                                                                           |    

 
```